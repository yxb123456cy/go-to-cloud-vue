import{d as B,r as f,a as b,E as A,c as p,o as _,b as s,f as o,w as e,M as v,g as l,F as I,s as V,t as C,v as r,B as E,j}from"./index-DJUXxr88.js";import"./index-CK5aMVwv.js";import{S as M,O as F}from"./index-DjVtTPI3.js";import{T as H}from"./index-CWyVRzfV.js";import{T as W}from"./index-DSuL0VRM.js";import{R as q,C as G}from"./index-CuqxcLwh.js";import{R as J}from"./index-Dmsz_dQl.js";import"./index-DIU2H-5S.js";import{I as K}from"./index-BImJgcX3.js";const Q={class:"p-6"},X={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},Y={class:"bg-white rounded-lg shadow-sm border border-gray-200"},Z={class:"font-medium text-gray-900"},$={class:"text-sm text-gray-500"},tt={class:"text-sm text-gray-600"},et={key:0},at={class:"text-sm text-gray-900"},ot={class:"text-xs text-gray-500"},nt={key:1,class:"text-sm text-gray-500"},ft=B({__name:"ArtifactDownloadView",setup(st){const g=f(!1),w=f([]),x=f([]),y=f([]),d=b({artifactId:"",action:"",hostId:"",dateRange:[]}),c=b({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:!0}),N=[{title:"制品信息",dataIndex:"artifact",slotName:"artifact",width:200},{title:"操作类型",dataIndex:"action",slotName:"action",width:100},{title:"操作用户",dataIndex:"user",slotName:"user",width:120},{title:"目标主机",dataIndex:"host",slotName:"host",width:150},{title:"操作时间",dataIndex:"created_at",slotName:"created_at",width:180}];function L(n){return new Date(n).toLocaleString("zh-CN")}function S(n){c.current=n,i()}function k(n){c.pageSize=n,c.current=1,i()}async function P(){try{x.value=[{id:1,project_id:1,repo_id:1,name:"web-frontend",version:"v1.0.0",type_id:1,path:"myorg/web-frontend:v1.0.0",created_at:""}]}catch(n){console.error(n),v.error("加载制品列表失败")}}async function R(){try{y.value=[{id:1,host_group_id:1,name:"生产服务器1",ip:"192.168.1.100",port:8080,status:"ONLINE",created_at:"",updated_at:""}]}catch(n){console.error(n),v.error("加载主机列表失败")}}async function i(){try{g.value=!0,w.value=[{id:1,artifact_id:1,user_id:1,host_id:1,action:"PULL",created_at:new Date().toISOString(),artifact:{id:1,project_id:1,repo_id:1,name:"web-frontend",version:"v1.0.0",type_id:1,path:"",created_at:""},user:{id:"1",username:"admin",email:"",avatar:"",createdAt:""},host:{id:1,host_group_id:1,name:"生产服务器1",ip:"192.168.1.100",port:8080,status:"ONLINE",created_at:"",updated_at:""}}],c.total=1}catch(n){console.error(n),v.error("加载下载记录失败")}finally{g.value=!1}}return A(()=>{P(),R(),i()}),(n,a)=>{const u=F,h=M,m=G,U=J,D=E,O=q,T=H,z=W;return _(),p("div",Q,[a[10]||(a[10]=s("div",{class:"mb-6"},[s("h1",{class:"text-2xl font-bold text-gray-900 mb-2"}," 制品下载记录 "),s("p",{class:"text-gray-600"}," 查看制品下载和拉取历史 ")],-1)),s("div",X,[o(O,{gutter:16},{default:e(()=>[o(m,{span:5},{default:e(()=>[o(h,{modelValue:d.artifactId,"onUpdate:modelValue":a[0]||(a[0]=t=>d.artifactId=t),placeholder:"选择制品","allow-clear":"",onChange:i},{default:e(()=>[o(u,{value:""},{default:e(()=>a[4]||(a[4]=[l(" 全部制品 ",-1)])),_:1,__:[4]}),(_(!0),p(I,null,V(x.value,t=>(_(),C(u,{key:t.id,value:t.id},{default:e(()=>[l(r(t.name)+":"+r(t.version),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(m,{span:4},{default:e(()=>[o(h,{modelValue:d.action,"onUpdate:modelValue":a[1]||(a[1]=t=>d.action=t),placeholder:"操作类型","allow-clear":"",onChange:i},{default:e(()=>[o(u,{value:""},{default:e(()=>a[5]||(a[5]=[l(" 全部操作 ",-1)])),_:1,__:[5]}),o(u,{value:"PULL"},{default:e(()=>a[6]||(a[6]=[l(" 拉取 ",-1)])),_:1,__:[6]}),o(u,{value:"DOWNLOAD"},{default:e(()=>a[7]||(a[7]=[l(" 下载 ",-1)])),_:1,__:[7]})]),_:1},8,["modelValue"])]),_:1}),o(m,{span:5},{default:e(()=>[o(h,{modelValue:d.hostId,"onUpdate:modelValue":a[2]||(a[2]=t=>d.hostId=t),placeholder:"选择主机","allow-clear":"",onChange:i},{default:e(()=>[o(u,{value:""},{default:e(()=>a[8]||(a[8]=[l(" 全部主机 ",-1)])),_:1,__:[8]}),(_(!0),p(I,null,V(y.value,t=>(_(),C(u,{key:t.id,value:t.id},{default:e(()=>[l(r(t.name)+" ("+r(t.ip)+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(m,{span:6},{default:e(()=>[o(U,{modelValue:d.dateRange,"onUpdate:modelValue":a[3]||(a[3]=t=>d.dateRange=t),onChange:i},null,8,["modelValue"])]),_:1}),o(m,{span:4},{default:e(()=>[o(D,{onClick:i},{icon:e(()=>[o(j(K))]),default:e(()=>[a[9]||(a[9]=l(" 刷新 ",-1))]),_:1,__:[9]})]),_:1})]),_:1})]),s("div",Y,[o(z,{columns:N,data:w.value,loading:g.value,pagination:c,onPageChange:S,onPageSizeChange:k},{artifact:e(({record:t})=>[s("div",null,[s("p",Z,r(t.artifact?.name),1),s("p",$,r(t.artifact?.version),1)])]),action:e(({record:t})=>[o(T,{color:t.action==="PULL"?"blue":"green"},{default:e(()=>[l(r(t.action==="PULL"?"拉取":"下载"),1)]),_:2},1032,["color"])]),user:e(({record:t})=>[s("span",tt,r(t.user?.username||"系统操作"),1)]),host:e(({record:t})=>[t.host?(_(),p("div",et,[s("p",at,r(t.host.name),1),s("p",ot,r(t.host.ip),1)])):(_(),p("span",nt,"-"))]),created_at:e(({record:t})=>[l(r(L(t.created_at)),1)]),_:1},8,["data","loading","pagination"])])])}}});export{ft as default};
