import{k as st,d as O,c as S,o as g,b as r,n as rt,l as R,m as lt,p as L,q as it,r as y,a as $,s as dt,f as o,w as a,M as h,g as l,F as z,A as V,D as N,t as i,B as ut,j as D,E as P,h as ct}from"./index-DpkOdSpx.js";/* empty css              */import{R as _t,b as mt}from"./index-NTQZ5pKC.js";import{T as pt,S as gt,O as ft}from"./index-Opp2L5Up.js";import{T as vt}from"./index-DT4y2raZ.js";import{S as ht}from"./index-CqC8rdLl.js";import{R as bt}from"./index-Dt-lsPFm.js";import"./index-CJSshvje.js";import{M as U}from"./index-D8cCLrR9.js";import{I as F}from"./index-DjfomgFW.js";const yt=O({name:"IconStop",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:s=>["butt","round","square"].includes(s)},strokeLinejoin:{type:String,default:"miter",validator:s=>["arcs","bevel","miter","miter-clip","round"].includes(s)},rotate:Number,spin:Boolean},emits:{click:s=>!0},setup(s,{emit:d}){const c=lt("icon"),v=L(()=>[c,`${c}-stop`,{[`${c}-spin`]:s.spin}]),w=L(()=>{const _={};return s.size&&(_.fontSize=it(s.size)?`${s.size}px`:s.size),s.rotate&&(_.transform=`rotate(${s.rotate}deg)`),_});return{cls:v,innerStyle:w,onClick:_=>{d("click",_)}}}}),St=["stroke-width","stroke-linecap","stroke-linejoin"];function wt(s,d,c,v,w,I){return g(),S("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:R(s.cls),style:rt(s.innerStyle),"stroke-width":s.strokeWidth,"stroke-linecap":s.strokeLinecap,"stroke-linejoin":s.strokeLinejoin,onClick:d[0]||(d[0]=(..._)=>s.onClick&&s.onClick(..._))},d[1]||(d[1]=[r("path",{d:"M36.728 36.728c7.03-7.03 7.03-18.427 0-25.456-7.03-7.03-18.427-7.03-25.456 0m25.456 25.456c-7.03 7.03-18.427 7.03-25.456 0-7.03-7.03-7.03-18.427 0-25.456m25.456 25.456L11.272 11.272"},null,-1)]),14,St)}var E=st(yt,[["render",wt]]);const Ct=Object.assign(E,{install:(s,d)=>{var c;const v=(c=d?.iconPrefix)!=null?c:"";s.component(v+E.name,E)}}),kt={class:"p-6 bg-gray-50 min-h-screen"},It={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},Nt={class:"bg-white rounded-lg shadow-sm border border-gray-200"},xt={class:"font-medium text-gray-900"},Dt={class:"text-sm text-gray-500"},Et={class:"font-medium text-gray-900"},jt={class:"text-sm text-gray-500"},Lt={class:"text-sm bg-gray-100 px-2 py-1 rounded block mb-1"},$t={class:"text-sm text-gray-600"},zt={class:"flex items-center space-x-2"},Vt={class:"bg-black text-green-400 p-4 rounded font-mono text-sm max-h-96 overflow-y-auto"},Pt={key:0},Ut={key:1,class:"text-gray-500"},Ht=O({__name:"DeployHistoryView",setup(s){const d=y(!1),c=y(!1),v=y([]),w=y([]),I=y([]),_=y(""),f=$({projectId:"",hostId:"",status:"",dateRange:[]}),C=$({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:!0}),M=[{title:"项目",dataIndex:"project",slotName:"project",width:180},{title:"目标主机",dataIndex:"host",slotName:"host",width:180},{title:"容器信息",dataIndex:"container",slotName:"container",width:200},{title:"状态",dataIndex:"status",slotName:"status",width:120},{title:"耗时",dataIndex:"duration",slotName:"duration",width:100},{title:"开始时间",dataIndex:"created_at",slotName:"created_at",width:180},{title:"操作",slotName:"actions",width:180,align:"center"}],T=n=>new Date(n).toLocaleString("zh-CN"),A=n=>{switch(n){case"SUCCESS":return"bg-green-500";case"FAILED":return"bg-red-500";case"RUNNING":return"bg-blue-500";case"PENDING":return"bg-yellow-500";default:return"bg-gray-500"}},B=n=>{switch(n){case"SUCCESS":return"green";case"FAILED":return"red";case"RUNNING":return"blue";case"PENDING":return"orange";default:return"gray"}},G=n=>{switch(n){case"SUCCESS":return"成功";case"FAILED":return"失败";case"RUNNING":return"运行中";case"PENDING":return"等待中";default:return"未知"}},W=(n,e)=>{const m=new Date(n).getTime(),k=new Date(e).getTime(),u=Math.floor((k-m)/1e3);if(u<60)return`${u}秒`;if(u<3600)return`${Math.floor(u/60)}分${u%60}秒`;{const x=Math.floor(u/3600),b=Math.floor(u%3600/60);return`${x}时${b}分`}},q=n=>{C.current=n,p()},H=n=>{C.pageSize=n,C.current=1,p()},J=n=>{_.value=n.log||"暂无日志信息",c.value=!0},K=n=>{U.confirm({title:"确认停止",content:`确定要停止容器 "${n.container_name}" 吗？`,onOk:async()=>{try{h.success("容器停止成功"),p()}catch{h.error("停止容器失败")}}})},Q=async n=>{try{console.log("重新部署项目",n.project_id,n.host_id,n.image_tag),h.success("重新部署任务已启动"),p()}catch{h.error("启动重新部署失败")}},X=async()=>{try{w.value=[{id:1,name:"Web前端项目",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""},{id:2,name:"API服务",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""}]}catch{h.error("加载项目列表失败")}},Y=async()=>{try{I.value=[{id:1,host_group_id:1,name:"生产服务器1",ip:"192.168.1.100",port:8080,status:"ONLINE",created_at:"",updated_at:""},{id:2,host_group_id:1,name:"生产服务器2",ip:"192.168.1.101",port:8080,status:"OFFLINE",created_at:"",updated_at:""}]}catch{h.error("加载主机列表失败")}},p=async()=>{try{d.value=!0,v.value=[{id:1,project_id:1,host_id:1,image_tag:"v1.0.0",container_name:"web-frontend-prod",status:"SUCCESS",log:`部署开始...
拉取镜像...
启动容器...
部署完成`,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),project:{id:1,name:"Web前端项目",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""},host:{id:1,host_group_id:1,name:"生产服务器1",ip:"192.168.1.100",port:8080,status:"ONLINE",created_at:"",updated_at:""}},{id:2,project_id:2,host_id:2,image_tag:"v1.0.1",container_name:"api-service-prod",status:"FAILED",log:`部署开始...
拉取镜像...
启动容器失败：端口被占用`,created_at:new Date(Date.now()-3e5).toISOString(),updated_at:new Date(Date.now()-18e4).toISOString(),project:{id:2,name:"API服务",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""},host:{id:2,host_group_id:1,name:"生产服务器2",ip:"192.168.1.101",port:8080,status:"OFFLINE",created_at:"",updated_at:""}}],C.total=2}catch{h.error("加载部署历史失败")}finally{d.value=!1}};return dt(()=>{X(),Y(),p()}),(n,e)=>{const m=ft,k=gt,u=mt,x=bt,b=ut,Z=_t,tt=vt,et=ct("icon-file-text"),at=ht,ot=pt,nt=U;return g(),S("div",kt,[e[16]||(e[16]=r("div",{class:"mb-6"},[r("h1",{class:"text-2xl font-bold text-gray-900 mb-2"},"部署历史"),r("p",{class:"text-gray-600"},"查看项目部署记录和日志")],-1)),r("div",It,[o(Z,{gutter:16},{default:a(()=>[o(u,{span:5},{default:a(()=>[o(k,{modelValue:f.projectId,"onUpdate:modelValue":e[0]||(e[0]=t=>f.projectId=t),placeholder:"选择项目","allow-clear":"",onChange:p},{default:a(()=>[o(m,{value:""},{default:a(()=>e[5]||(e[5]=[l("全部项目",-1)])),_:1,__:[5]}),(g(!0),S(z,null,V(w.value,t=>(g(),N(m,{key:t.id,value:t.id},{default:a(()=>[l(i(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(u,{span:5},{default:a(()=>[o(k,{modelValue:f.hostId,"onUpdate:modelValue":e[1]||(e[1]=t=>f.hostId=t),placeholder:"选择主机","allow-clear":"",onChange:p},{default:a(()=>[o(m,{value:""},{default:a(()=>e[6]||(e[6]=[l("全部主机",-1)])),_:1,__:[6]}),(g(!0),S(z,null,V(I.value,t=>(g(),N(m,{key:t.id,value:t.id},{default:a(()=>[l(i(t.name)+" ("+i(t.ip)+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(u,{span:5},{default:a(()=>[o(k,{modelValue:f.status,"onUpdate:modelValue":e[2]||(e[2]=t=>f.status=t),placeholder:"选择状态","allow-clear":"",onChange:p},{default:a(()=>[o(m,{value:""},{default:a(()=>e[7]||(e[7]=[l("全部状态",-1)])),_:1,__:[7]}),o(m,{value:"PENDING"},{default:a(()=>e[8]||(e[8]=[l("等待中",-1)])),_:1,__:[8]}),o(m,{value:"RUNNING"},{default:a(()=>e[9]||(e[9]=[l("运行中",-1)])),_:1,__:[9]}),o(m,{value:"SUCCESS"},{default:a(()=>e[10]||(e[10]=[l("成功",-1)])),_:1,__:[10]}),o(m,{value:"FAILED"},{default:a(()=>e[11]||(e[11]=[l("失败",-1)])),_:1,__:[11]})]),_:1},8,["modelValue"])]),_:1}),o(u,{span:5},{default:a(()=>[o(x,{modelValue:f.dateRange,"onUpdate:modelValue":e[3]||(e[3]=t=>f.dateRange=t),onChange:p},null,8,["modelValue"])]),_:1}),o(u,{span:4},{default:a(()=>[o(b,{onClick:p},{icon:a(()=>[o(D(F))]),default:a(()=>[e[12]||(e[12]=l(" 刷新 ",-1))]),_:1,__:[12]})]),_:1})]),_:1})]),r("div",Nt,[o(ot,{columns:M,data:v.value,loading:d.value,pagination:C,onPageChange:q,onPageSizeChange:H},{project:a(({record:t})=>[r("div",null,[r("p",xt,i(t.project?.name||"未知项目"),1),r("p",Dt,"ID: "+i(t.project_id),1)])]),host:a(({record:t})=>[r("div",null,[r("p",Et,i(t.host?.name||"未知主机"),1),r("p",jt,i(t.host?.ip)+":"+i(t.host?.port),1)])]),container:a(({record:t})=>[r("div",null,[r("code",Lt,i(t.image_tag),1),r("p",$t,i(t.container_name),1)])]),status:a(({record:t})=>[r("div",zt,[r("div",{class:R(["w-2 h-2 rounded-full",A(t.status)])},null,2),o(tt,{color:B(t.status)},{default:a(()=>[l(i(G(t.status)),1)]),_:2},1032,["color"])])]),duration:a(({record:t})=>[l(i(W(t.created_at,t.updated_at)),1)]),created_at:a(({record:t})=>[l(i(T(t.created_at)),1)]),actions:a(({record:t})=>[o(at,null,{default:a(()=>[o(b,{type:"text",size:"small",onClick:j=>J(t)},{icon:a(()=>[o(et)]),default:a(()=>[e[13]||(e[13]=l(" 查看日志 ",-1))]),_:2,__:[13]},1032,["onClick"]),t.status==="SUCCESS"?(g(),N(b,{key:0,type:"text",size:"small",onClick:j=>K(t)},{icon:a(()=>[o(D(Ct))]),default:a(()=>[e[14]||(e[14]=l(" 停止容器 ",-1))]),_:2,__:[14]},1032,["onClick"])):P("",!0),t.status==="FAILED"?(g(),N(b,{key:1,type:"text",size:"small",onClick:j=>Q(t)},{icon:a(()=>[o(D(F))]),default:a(()=>[e[15]||(e[15]=l(" 重新部署 ",-1))]),_:2,__:[15]},1032,["onClick"])):P("",!0)]),_:2},1024)]),_:1},8,["data","loading","pagination"])]),o(nt,{visible:c.value,"onUpdate:visible":e[4]||(e[4]=t=>c.value=t),title:"部署日志",width:"80%",footer:!1},{default:a(()=>[r("div",Vt,[_.value?(g(),S("pre",Pt,i(_.value),1)):(g(),S("div",Ut,"暂无日志信息"))])]),_:1},8,["visible"])])}}});export{Ht as default};
