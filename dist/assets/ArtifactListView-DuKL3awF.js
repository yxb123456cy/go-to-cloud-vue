import{d as q,r as _,a as j,s as G,c as v,o as u,b as l,f as o,w as t,M as c,B as Q,g as n,j as w,F as I,A as x,D as k,t as d,i as X}from"./index-DpkOdSpx.js";import{R as Z,b as ee,c as te,d as ae}from"./index-NTQZ5pKC.js";import{T as oe,S as re,O as ne}from"./index-Opp2L5Up.js";import{T as le}from"./index-DT4y2raZ.js";import{S as de}from"./index-CqC8rdLl.js";import{I as se}from"./index-DjfomgFW.js";import{I as ie}from"./index-B1YG0VM7.js";import{I as ce}from"./index-BgAednXr.js";import{M as ue}from"./index-D8cCLrR9.js";const pe={class:"p-6"},_e={class:"flex items-center justify-between mb-6"},me={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},fe={class:"bg-white rounded-lg shadow-sm border border-gray-200"},ge={class:"font-medium text-gray-900"},ye={class:"text-sm text-gray-500"},ve={class:"text-sm text-gray-600"},we={class:"text-sm text-gray-600"},De=q({__name:"ArtifactListView",setup(he){const M=X(),h=_(!1),C=_([]),N=_([]),S=_([]),V=_([]),f=_([]),i=j({projectId:"",typeId:"",repoId:"",keyword:""}),m=j({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:!0}),R=[{title:"制品信息",dataIndex:"name",slotName:"name",width:250},{title:"版本",dataIndex:"version",slotName:"version",width:120},{title:"类型",dataIndex:"type",slotName:"type",width:100},{title:"所属项目",dataIndex:"project",slotName:"project",width:150},{title:"仓库",dataIndex:"repo",slotName:"repo",width:120},{title:"创建时间",dataIndex:"created_at",slotName:"created_at",width:180},{title:"操作",slotName:"actions",width:180,align:"center"}],T=r=>new Date(r).toLocaleString("zh-CN"),z=r=>({DOCKER:"blue",NPM:"green",JAR:"orange",MAVEN:"red",PYPI:"yellow"})[r||""]||"gray",O=r=>{m.current=r,s()},$=r=>{m.pageSize=r,m.current=1,s()},B=r=>{M.push(`/artifacts/${r.id}`)},E=async r=>{try{f.value.push(r.id),c.success(`制品 ${r.name} 下载开始`)}catch{c.error("下载失败")}finally{f.value=f.value.filter(a=>a!==r.id)}},J=r=>{ue.confirm({title:"确认删除",content:`确定要删除制品 "${r.name}:${r.version}" 吗？此操作不可恢复。`,onOk:async()=>{try{c.success("删除成功"),s()}catch{c.error("删除失败")}}})},U=()=>{s()},K=async()=>{try{N.value=[{id:1,name:"Web前端项目",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""},{id:2,name:"API服务",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""}]}catch{c.error("加载项目列表失败")}},L=async()=>{try{S.value=[{id:1,name:"DOCKER",description:"Docker镜像",created_at:""},{id:2,name:"NPM",description:"NPM包",created_at:""},{id:3,name:"JAR",description:"Java JAR包",created_at:""}]}catch{c.error("加载制品类型失败")}},F=async()=>{try{V.value=[{id:1,name:"Docker Hub",type_id:1,url:"docker.io",created_at:"",updated_at:""},{id:2,name:"NPM Registry",type_id:2,url:"registry.npmjs.org",created_at:"",updated_at:""}]}catch{c.error("加载制品仓库失败")}},s=async()=>{try{h.value=!0,C.value=[{id:1,project_id:1,repo_id:1,name:"web-frontend",version:"v1.0.0",type_id:1,path:"myorg/web-frontend:v1.0.0",created_at:new Date().toISOString(),project:{id:1,name:"Web前端项目",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""},artifact_repo:{id:1,name:"Docker Hub",type_id:1,url:"docker.io",created_at:"",updated_at:""},artifact_type:{id:1,name:"DOCKER",description:"Docker镜像",created_at:""}},{id:2,project_id:2,repo_id:2,name:"@myorg/api-utils",version:"2.1.0",type_id:2,path:"@myorg/api-utils",created_at:new Date(Date.now()-864e5).toISOString(),project:{id:2,name:"API服务",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""},artifact_repo:{id:2,name:"NPM Registry",type_id:2,url:"registry.npmjs.org",created_at:"",updated_at:""},artifact_type:{id:2,name:"NPM",description:"NPM包",created_at:""}}],m.total=2}catch{c.error("加载制品列表失败")}finally{h.value=!1}};return G(()=>{K(),L(),F(),s()}),(r,a)=>{const g=Q,A=de,p=ne,b=re,y=ee,H=te,W=Z,D=le,Y=oe;return u(),v("div",pe,[l("div",_e,[a[5]||(a[5]=l("div",null,[l("h1",{class:"text-2xl font-bold text-gray-900 mb-2"},"制品列表"),l("p",{class:"text-gray-600"},"查看和管理所有制品")],-1)),o(A,null,{default:t(()=>[o(g,{onClick:U},{icon:t(()=>[o(w(se))]),default:t(()=>[a[4]||(a[4]=n(" 刷新 ",-1))]),_:1,__:[4]})]),_:1})]),l("div",me,[o(W,{gutter:16},{default:t(()=>[o(y,{span:5},{default:t(()=>[o(b,{modelValue:i.projectId,"onUpdate:modelValue":a[0]||(a[0]=e=>i.projectId=e),placeholder:"选择项目","allow-clear":"",onChange:s},{default:t(()=>[o(p,{value:""},{default:t(()=>a[6]||(a[6]=[n("全部项目",-1)])),_:1,__:[6]}),(u(!0),v(I,null,x(N.value,e=>(u(),k(p,{key:e.id,value:e.id},{default:t(()=>[n(d(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(y,{span:5},{default:t(()=>[o(b,{modelValue:i.typeId,"onUpdate:modelValue":a[1]||(a[1]=e=>i.typeId=e),placeholder:"选择类型","allow-clear":"",onChange:s},{default:t(()=>[o(p,{value:""},{default:t(()=>a[7]||(a[7]=[n("全部类型",-1)])),_:1,__:[7]}),(u(!0),v(I,null,x(S.value,e=>(u(),k(p,{key:e.id,value:e.id},{default:t(()=>[n(d(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(y,{span:5},{default:t(()=>[o(b,{modelValue:i.repoId,"onUpdate:modelValue":a[2]||(a[2]=e=>i.repoId=e),placeholder:"选择仓库","allow-clear":"",onChange:s},{default:t(()=>[o(p,{value:""},{default:t(()=>a[8]||(a[8]=[n("全部仓库",-1)])),_:1,__:[8]}),(u(!0),v(I,null,x(V.value,e=>(u(),k(p,{key:e.id,value:e.id},{default:t(()=>[n(d(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(y,{span:9},{default:t(()=>[o(H,{modelValue:i.keyword,"onUpdate:modelValue":a[3]||(a[3]=e=>i.keyword=e),placeholder:"搜索制品名称或版本",onSearch:s},null,8,["modelValue"])]),_:1})]),_:1})]),l("div",fe,[o(Y,{columns:R,data:C.value,loading:h.value,pagination:m,onPageChange:O,onPageSizeChange:$},{name:t(({record:e})=>[l("div",null,[l("p",ge,d(e.name),1),l("p",ye,d(e.path),1)])]),version:t(({record:e})=>[o(D,{color:"blue"},{default:t(()=>[n(d(e.version),1)]),_:2},1024)]),type:t(({record:e})=>[o(D,{color:z(e.artifact_type?.name)},{default:t(()=>[n(d(e.artifact_type?.name||"未知"),1)]),_:2},1032,["color"])]),project:t(({record:e})=>[l("span",ve,d(e.project?.name||"未知项目"),1)]),repo:t(({record:e})=>[l("span",we,d(e.artifact_repo?.name||"未知仓库"),1)]),created_at:t(({record:e})=>[n(d(T(e.created_at)),1)]),actions:t(({record:e})=>[o(A,null,{default:t(()=>[o(g,{type:"text",size:"small",onClick:P=>B(e)},{icon:t(()=>[o(w(ae))]),default:t(()=>[a[9]||(a[9]=n(" 详情 ",-1))]),_:2,__:[9]},1032,["onClick"]),o(g,{type:"text",size:"small",onClick:P=>E(e),loading:f.value.includes(e.id)},{icon:t(()=>[o(w(ie))]),default:t(()=>[a[10]||(a[10]=n(" 下载 ",-1))]),_:2,__:[10]},1032,["onClick","loading"]),o(g,{type:"text",size:"small",status:"danger",onClick:P=>J(e)},{icon:t(()=>[o(w(ce))]),default:t(()=>[a[11]||(a[11]=n(" 删除 ",-1))]),_:2,__:[11]},1032,["onClick"])]),_:2},1024)]),_:1},8,["data","loading","pagination"])])])}}});export{De as default};
