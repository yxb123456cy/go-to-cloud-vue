import{d as J,r as p,a as y,G as K,z as Q,c as v,o as _,b as l,f as o,w as a,M as b,g as r,F as X,s as Y,t as x,v as i,B as Z,j as D,H as ee,h as te,l as ae}from"./index-CWkTdfTI.js";/* empty css              */import"./index-BBxfLePQ.js";import{S as oe,O as ne}from"./index-Cnpsw9AU.js";import{T as re}from"./index-BnQlv6tf.js";import{T as se}from"./index-Bj-pk1Oh.js";import{S as le}from"./index-DaljsaQM.js";import{R as de,C as ue}from"./index-C7QiuXXS.js";import{R as ie}from"./index-BEPei7qO.js";import"./index-BAowSdcq.js";import{M as ce}from"./index-DKM5Hh1L.js";import{I as E}from"./index-BUX5n9pn.js";const _e={class:"p-6 bg-gray-50 min-h-screen"},me={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},ge={class:"bg-white rounded-lg shadow-sm border border-gray-200"},pe={class:"font-medium text-gray-900"},fe={class:"text-sm text-gray-500"},ve={class:"text-sm bg-gray-100 px-2 py-1 rounded"},be={class:"flex items-center space-x-2"},we={class:"bg-black text-green-400 p-4 rounded font-mono text-sm max-h-96 overflow-y-auto"},Se={key:0},Ie={key:1,class:"text-gray-500"},Ue=J({__name:"BuildHistoryView",setup(Ce){const j=K(),w=p(!1),S=p(!1),h=p([]),N=p([]),I=p(""),c=y({projectId:j.query.projectId||"",status:"",dateRange:[]}),m=y({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:!0}),k=[{title:"项目",dataIndex:"project",slotName:"project",width:200},{title:"镜像标签",dataIndex:"image_tag",slotName:"image_tag",width:200},{title:"状态",dataIndex:"status",slotName:"status",width:120},{title:"耗时",dataIndex:"duration",slotName:"duration",width:100},{title:"开始时间",dataIndex:"created_at",slotName:"created_at",width:180},{title:"操作",slotName:"actions",width:150,align:"center"}];function V(n){return new Date(n).toLocaleString("zh-CN")}function P(n){switch(n){case"SUCCESS":return"bg-green-500";case"FAILED":return"bg-red-500";case"RUNNING":return"bg-blue-500";case"PENDING":return"bg-yellow-500";default:return"bg-gray-500"}}function R(n){switch(n){case"SUCCESS":return"green";case"FAILED":return"red";case"RUNNING":return"blue";case"PENDING":return"orange";default:return"gray"}}function T(n){switch(n){case"SUCCESS":return"成功";case"FAILED":return"失败";case"RUNNING":return"运行中";case"PENDING":return"等待中";default:return"未知"}}function U(n,e){const d=new Date(n).getTime(),f=new Date(e).getTime(),s=Math.floor((f-d)/1e3);if(s<60)return`${s}秒`;if(s<3600)return`${Math.floor(s/60)}分${s%60}秒`;{const C=Math.floor(s/3600),g=Math.floor(s%3600/60);return`${C}时${g}分`}}function L(n){m.current=n,u()}function z(n){m.pageSize=n,m.current=1,u()}function F(n){I.value=n.log||"暂无日志信息",S.value=!0}async function M(n){try{console.warn("build:",n),b.success("重新构建任务已启动"),u()}catch(e){console.error(e),b.error("启动重新构建失败")}}async function G(){try{N.value=[{id:1,name:"Web前端项目",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""},{id:2,name:"API服务",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""}]}catch(n){console.error(n),b.error("加载项目列表失败")}}async function u(){try{w.value=!0,h.value=[{id:1,project_id:1,image_tag:"v1.0.0",status:"SUCCESS",log:`构建开始...
下载依赖...
编译代码...
构建完成`,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),project:{id:1,name:"Web前端项目",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""}},{id:2,project_id:2,image_tag:"v1.0.1",status:"FAILED",log:`构建开始...
下载依赖...
编译失败：语法错误`,created_at:new Date(Date.now()-3e5).toISOString(),updated_at:new Date(Date.now()-18e4).toISOString(),project:{id:2,name:"API服务",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""}}],m.total=2}catch(n){console.error(n),b.error("加载构建历史失败")}finally{w.value=!1}}return Q(()=>{G(),u()}),(n,e)=>{const d=ne,f=oe,s=ue,C=ie,g=Z,A=de,B=re,$=te("IconFileText"),O=le,H=se,W=ce;return _(),v("div",_e,[e[13]||(e[13]=l("div",{class:"mb-6"},[l("h1",{class:"text-2xl font-bold text-gray-900 mb-2"}," 构建历史 "),l("p",{class:"text-gray-600"}," 查看项目构建记录和日志 ")],-1)),l("div",me,[o(A,{gutter:16},{default:a(()=>[o(s,{span:6},{default:a(()=>[o(f,{modelValue:c.projectId,"onUpdate:modelValue":e[0]||(e[0]=t=>c.projectId=t),placeholder:"选择项目","allow-clear":"",onChange:u},{default:a(()=>[o(d,{value:""},{default:a(()=>e[4]||(e[4]=[r(" 全部项目 ",-1)])),_:1,__:[4]}),(_(!0),v(X,null,Y(N.value,t=>(_(),x(d,{key:t.id,value:t.id},{default:a(()=>[r(i(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(s,{span:6},{default:a(()=>[o(f,{modelValue:c.status,"onUpdate:modelValue":e[1]||(e[1]=t=>c.status=t),placeholder:"选择状态","allow-clear":"",onChange:u},{default:a(()=>[o(d,{value:""},{default:a(()=>e[5]||(e[5]=[r(" 全部状态 ",-1)])),_:1,__:[5]}),o(d,{value:"PENDING"},{default:a(()=>e[6]||(e[6]=[r(" 等待中 ",-1)])),_:1,__:[6]}),o(d,{value:"RUNNING"},{default:a(()=>e[7]||(e[7]=[r(" 运行中 ",-1)])),_:1,__:[7]}),o(d,{value:"SUCCESS"},{default:a(()=>e[8]||(e[8]=[r(" 成功 ",-1)])),_:1,__:[8]}),o(d,{value:"FAILED"},{default:a(()=>e[9]||(e[9]=[r(" 失败 ",-1)])),_:1,__:[9]})]),_:1},8,["modelValue"])]),_:1}),o(s,{span:8},{default:a(()=>[o(C,{modelValue:c.dateRange,"onUpdate:modelValue":e[2]||(e[2]=t=>c.dateRange=t),onChange:u},null,8,["modelValue"])]),_:1}),o(s,{span:4},{default:a(()=>[o(g,{onClick:u},{icon:a(()=>[o(D(E))]),default:a(()=>[e[10]||(e[10]=r(" 刷新 ",-1))]),_:1,__:[10]})]),_:1})]),_:1})]),l("div",ge,[o(H,{columns:k,data:h.value,loading:w.value,pagination:m,onPageChange:L,onPageSizeChange:z},{project:a(({record:t})=>[l("div",null,[l("p",pe,i(t.project?.name||"未知项目"),1),l("p",fe," ID: "+i(t.project_id),1)])]),image_tag:a(({record:t})=>[l("code",ve,i(t.image_tag),1)]),status:a(({record:t})=>[l("div",be,[l("div",{class:ae(["w-2 h-2 rounded-full",P(t.status)])},null,2),o(B,{color:R(t.status)},{default:a(()=>[r(i(T(t.status)),1)]),_:2},1032,["color"])])]),duration:a(({record:t})=>[r(i(U(t.created_at,t.updated_at)),1)]),created_at:a(({record:t})=>[r(i(V(t.created_at)),1)]),actions:a(({record:t})=>[o(O,null,{default:a(()=>[o(g,{type:"text",size:"small",onClick:q=>F(t)},{icon:a(()=>[o($)]),default:a(()=>[e[11]||(e[11]=r(" 查看日志 ",-1))]),_:2,__:[11]},1032,["onClick"]),t.status==="FAILED"?(_(),x(g,{key:0,type:"text",size:"small",onClick:q=>M(t)},{icon:a(()=>[o(D(E))]),default:a(()=>[e[12]||(e[12]=r(" 重新构建 ",-1))]),_:2,__:[12]},1032,["onClick"])):ee("",!0)]),_:2},1024)]),_:1},8,["data","loading","pagination"])]),o(W,{visible:S.value,"onUpdate:visible":e[3]||(e[3]=t=>S.value=t),title:"构建日志",width:"80%",footer:!1},{default:a(()=>[l("div",we,[I.value?(_(),v("pre",Se,i(I.value),1)):(_(),v("div",Ie," 暂无日志信息 "))])]),_:1},8,["visible"])])}}});export{Ue as default};
