import{d as Q,r as m,a as C,s as X,c as Y,o as Z,b as s,f as t,w as a,B as ee,M as i,g as r,j as p,t as v,l as te}from"./index-DpkOdSpx.js";/* empty css              */import{R as ae,b as oe,c as ne,I as le}from"./index-NTQZ5pKC.js";import{F as se,a as re}from"./index-DbrLpDkb.js";import{A as ie,I as ue}from"./index-D6Uh-XEk.js";/* empty css              */import{T as de,I as me,S as pe,O as ce,a as _e}from"./index-Opp2L5Up.js";import{T as fe}from"./index-DT4y2raZ.js";import{S as ge}from"./index-CqC8rdLl.js";import{M as O}from"./index-D8cCLrR9.js";import{I as ve}from"./index-DjfomgFW.js";import{I as Ie}from"./index-DM-O7xKJ.js";import{I as ye}from"./index-BnJnKAkJ.js";import{I as we}from"./index-BgAednXr.js";const Se={class:"p-6"},be={class:"flex items-center justify-between mb-6"},xe={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},Ce={class:"bg-white rounded-lg shadow-sm border border-gray-200"},Ne={class:"font-medium text-gray-900"},Ve={class:"text-sm text-gray-500"},ke={class:"flex items-center space-x-2"},Ae=Q({__name:"BuildNodeView",setup(he){const d=m(!1),c=m(!1),_=m(null),N=m([]),I=m([]),w=m(),l=C({name:"",ip:"",port:22}),y=C({status:"",keyword:""}),f=C({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:!0}),z=[{title:"节点信息",dataIndex:"name",slotName:"name",width:250},{title:"状态",dataIndex:"status",slotName:"status",width:100},{title:"创建时间",dataIndex:"created_at",slotName:"created_at",width:180},{title:"操作",slotName:"actions",width:200,align:"center"}],B={name:[{required:!0,message:"请输入节点名称"},{minLength:2,message:"节点名称至少2个字符"}],ip:[{required:!0,message:"请输入节点IP地址"}],port:[{required:!0,message:"请输入端口号"},{type:"number",min:1,max:65535,message:"端口号范围1-65535"}]},D=n=>new Date(n).toLocaleString("zh-CN"),V=()=>{l.name="",l.ip="",l.port=22,_.value=null,c.value=!1,w.value?.resetFields()},P=n=>{f.current=n,u()},E=n=>{f.pageSize=n,f.current=1,u()},F=n=>{_.value=n,l.name=n.name,l.ip=n.ip,l.port=n.port,c.value=!0},L=n=>{O.confirm({title:"确认删除",content:`确定要删除构建节点 "${n.name}" 吗？此操作不可恢复。`,onOk:async()=>{try{i.success("删除成功"),u()}catch{i.error("删除失败")}}})},T=async n=>{try{I.value.push(n.id),i.success(`构建节点 ${n.name} 连接正常`)}catch{i.error(`构建节点 ${n.name} 连接失败`)}finally{I.value=I.value.filter(e=>e!==n.id)}},$=async()=>{try{d.value=!0,i.success("状态刷新完成"),u()}catch{i.error("刷新状态失败")}finally{d.value=!1}},M=async()=>{try{if(!await w.value?.validate())return;d.value=!0,_.value?i.success("更新成功"):i.success("添加成功"),V(),u()}catch{i.error(_.value?"更新失败":"添加失败")}finally{d.value=!1}},u=async()=>{try{d.value=!0,N.value=[{id:1,name:"构建节点1",ip:"192.168.1.200",port:22,status:"ONLINE",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:2,name:"构建节点2",ip:"192.168.1.201",port:22,status:"OFFLINE",created_at:new Date(Date.now()-864e5).toISOString(),updated_at:new Date(Date.now()-864e5).toISOString()}],f.total=2}catch{i.error("加载构建节点列表失败")}finally{d.value=!1}};return X(()=>{u()}),(n,e)=>{const g=ee,S=ce,U=pe,b=oe,R=ne,q=ae,A=fe,j=ge,H=de,k=le,x=re,W=_e,G=ie,J=se,K=O;return Z(),Y("div",Se,[s("div",be,[e[8]||(e[8]=s("div",null,[s("h1",{class:"text-2xl font-bold text-gray-900 mb-2"},"构建节点配置"),s("p",{class:"text-gray-600"},"管理分布式构建节点")],-1)),t(g,{type:"primary",onClick:e[0]||(e[0]=o=>c.value=!0)},{icon:a(()=>[t(p(me))]),default:a(()=>[e[7]||(e[7]=r(" 添加节点 ",-1))]),_:1,__:[7]})]),s("div",xe,[t(q,{gutter:16},{default:a(()=>[t(b,{span:6},{default:a(()=>[t(U,{modelValue:y.status,"onUpdate:modelValue":e[1]||(e[1]=o=>y.status=o),placeholder:"选择状态","allow-clear":"",onChange:u},{default:a(()=>[t(S,{value:""},{default:a(()=>e[9]||(e[9]=[r("全部状态",-1)])),_:1,__:[9]}),t(S,{value:"ONLINE"},{default:a(()=>e[10]||(e[10]=[r("在线",-1)])),_:1,__:[10]}),t(S,{value:"OFFLINE"},{default:a(()=>e[11]||(e[11]=[r("离线",-1)])),_:1,__:[11]})]),_:1},8,["modelValue"])]),_:1}),t(b,{span:8},{default:a(()=>[t(R,{modelValue:y.keyword,"onUpdate:modelValue":e[2]||(e[2]=o=>y.keyword=o),placeholder:"搜索节点名称或IP",onSearch:u},null,8,["modelValue"])]),_:1}),t(b,{span:4},{default:a(()=>[t(g,{onClick:$},{icon:a(()=>[t(p(ve))]),default:a(()=>[e[12]||(e[12]=r(" 刷新状态 ",-1))]),_:1,__:[12]})]),_:1})]),_:1})]),s("div",Ce,[t(H,{columns:z,data:N.value,loading:d.value,pagination:f,onPageChange:P,onPageSizeChange:E},{name:a(({record:o})=>[s("div",null,[s("p",Ne,v(o.name),1),s("p",Ve,v(o.ip)+":"+v(o.port),1)])]),status:a(({record:o})=>[s("div",ke,[s("div",{class:te(["w-2 h-2 rounded-full",o.status==="ONLINE"?"bg-green-500":"bg-red-500"])},null,2),t(A,{color:o.status==="ONLINE"?"green":"red"},{default:a(()=>[r(v(o.status==="ONLINE"?"在线":"离线"),1)]),_:2},1032,["color"])])]),created_at:a(({record:o})=>[r(v(D(o.created_at)),1)]),actions:a(({record:o})=>[t(j,null,{default:a(()=>[t(g,{type:"text",size:"small",onClick:h=>T(o),loading:I.value.includes(o.id)},{icon:a(()=>[t(p(Ie))]),default:a(()=>[e[13]||(e[13]=r(" 测试连接 ",-1))]),_:2,__:[13]},1032,["onClick","loading"]),t(g,{type:"text",size:"small",onClick:h=>F(o)},{icon:a(()=>[t(p(ye))]),default:a(()=>[e[14]||(e[14]=r(" 编辑 ",-1))]),_:2,__:[14]},1032,["onClick"]),t(g,{type:"text",size:"small",status:"danger",onClick:h=>L(o)},{icon:a(()=>[t(p(we))]),default:a(()=>[e[15]||(e[15]=r(" 删除 ",-1))]),_:2,__:[15]},1032,["onClick"])]),_:2},1024)]),_:1},8,["data","loading","pagination"])]),t(K,{visible:c.value,"onUpdate:visible":e[6]||(e[6]=o=>c.value=o),title:_.value?"编辑构建节点":"添加构建节点",width:"600px",onOk:M,onCancel:V},{default:a(()=>[t(J,{ref_key:"formRef",ref:w,model:l,rules:B,layout:"vertical"},{default:a(()=>[t(x,{field:"name",label:"节点名称"},{default:a(()=>[t(k,{modelValue:l.name,"onUpdate:modelValue":e[3]||(e[3]=o=>l.name=o),placeholder:"请输入节点名称"},null,8,["modelValue"])]),_:1}),t(x,{field:"ip",label:"节点IP"},{default:a(()=>[t(k,{modelValue:l.ip,"onUpdate:modelValue":e[4]||(e[4]=o=>l.ip=o),placeholder:"请输入节点IP地址"},null,8,["modelValue"])]),_:1}),t(x,{field:"port",label:"SSH/API端口"},{default:a(()=>[t(W,{modelValue:l.port,"onUpdate:modelValue":e[5]||(e[5]=o=>l.port=o),placeholder:"请输入端口号",min:1,max:65535},null,8,["modelValue"])]),_:1}),t(G,{type:"info",class:"mt-4"},{icon:a(()=>[t(p(ue))]),default:a(()=>[e[16]||(e[16]=r(" 构建节点用于分布式构建任务。请确保节点已安装Docker和相关构建工具。 ",-1))]),_:1,__:[16]})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}});export{Ae as default};
