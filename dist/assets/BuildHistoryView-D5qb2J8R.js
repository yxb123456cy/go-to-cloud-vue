import{d as J,r as p,a as y,C as K,s as Q,c as b,o as _,b as l,f as o,w as a,M as v,g as s,F as X,A as Y,D as x,t as i,B as Z,j as D,E as ee,h as te,l as ae}from"./index-DpkOdSpx.js";/* empty css              */import{R as oe,b as ne}from"./index-NTQZ5pKC.js";import{T as se,S as re,O as le}from"./index-Opp2L5Up.js";import{T as de}from"./index-DT4y2raZ.js";import{S as ue}from"./index-CqC8rdLl.js";import{R as ie}from"./index-Dt-lsPFm.js";import"./index-CJSshvje.js";import{M as ce}from"./index-D8cCLrR9.js";import{I as E}from"./index-DjfomgFW.js";const _e={class:"p-6 bg-gray-50 min-h-screen"},me={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},ge={class:"bg-white rounded-lg shadow-sm border border-gray-200"},pe={class:"font-medium text-gray-900"},fe={class:"text-sm text-gray-500"},be={class:"text-sm bg-gray-100 px-2 py-1 rounded"},ve={class:"flex items-center space-x-2"},we={class:"bg-black text-green-400 p-4 rounded font-mono text-sm max-h-96 overflow-y-auto"},Se={key:0},Ce={key:1,class:"text-gray-500"},Re=J({__name:"BuildHistoryView",setup(he){const j=K(),w=p(!1),S=p(!1),I=p([]),N=p([]),C=p(""),c=y({projectId:j.query.projectId||"",status:"",dateRange:[]}),m=y({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:!0}),k=[{title:"项目",dataIndex:"project",slotName:"project",width:200},{title:"镜像标签",dataIndex:"image_tag",slotName:"image_tag",width:200},{title:"状态",dataIndex:"status",slotName:"status",width:120},{title:"耗时",dataIndex:"duration",slotName:"duration",width:100},{title:"开始时间",dataIndex:"created_at",slotName:"created_at",width:180},{title:"操作",slotName:"actions",width:150,align:"center"}],V=n=>new Date(n).toLocaleString("zh-CN"),P=n=>{switch(n){case"SUCCESS":return"bg-green-500";case"FAILED":return"bg-red-500";case"RUNNING":return"bg-blue-500";case"PENDING":return"bg-yellow-500";default:return"bg-gray-500"}},R=n=>{switch(n){case"SUCCESS":return"green";case"FAILED":return"red";case"RUNNING":return"blue";case"PENDING":return"orange";default:return"gray"}},U=n=>{switch(n){case"SUCCESS":return"成功";case"FAILED":return"失败";case"RUNNING":return"运行中";case"PENDING":return"等待中";default:return"未知"}},L=(n,e)=>{const d=new Date(n).getTime(),f=new Date(e).getTime(),r=Math.floor((f-d)/1e3);if(r<60)return`${r}秒`;if(r<3600)return`${Math.floor(r/60)}分${r%60}秒`;{const h=Math.floor(r/3600),g=Math.floor(r%3600/60);return`${h}时${g}分`}},T=n=>{m.current=n,u()},M=n=>{m.pageSize=n,m.current=1,u()},z=n=>{C.value=n.log||"暂无日志信息",S.value=!0},A=async n=>{try{console.log("重新构建项目",n.project_id),v.success("重新构建任务已启动"),u()}catch{v.error("启动重新构建失败")}},B=async()=>{try{N.value=[{id:1,name:"Web前端项目",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""},{id:2,name:"API服务",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""}]}catch{v.error("加载项目列表失败")}},u=async()=>{try{w.value=!0,I.value=[{id:1,project_id:1,image_tag:"v1.0.0",status:"SUCCESS",log:`构建开始...
下载依赖...
编译代码...
构建完成`,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),project:{id:1,name:"Web前端项目",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""}},{id:2,project_id:2,image_tag:"v1.0.1",status:"FAILED",log:`构建开始...
下载依赖...
编译失败：语法错误`,created_at:new Date(Date.now()-3e5).toISOString(),updated_at:new Date(Date.now()-18e4).toISOString(),project:{id:2,name:"API服务",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""}}],m.total=2}catch{v.error("加载构建历史失败")}finally{w.value=!1}};return Q(()=>{B(),u()}),(n,e)=>{const d=le,f=re,r=ne,h=ie,g=Z,F=oe,G=de,$=te("icon-file-text"),O=ue,W=se,q=ce;return _(),b("div",_e,[e[13]||(e[13]=l("div",{class:"mb-6"},[l("h1",{class:"text-2xl font-bold text-gray-900 mb-2"},"构建历史"),l("p",{class:"text-gray-600"},"查看项目构建记录和日志")],-1)),l("div",me,[o(F,{gutter:16},{default:a(()=>[o(r,{span:6},{default:a(()=>[o(f,{modelValue:c.projectId,"onUpdate:modelValue":e[0]||(e[0]=t=>c.projectId=t),placeholder:"选择项目","allow-clear":"",onChange:u},{default:a(()=>[o(d,{value:""},{default:a(()=>e[4]||(e[4]=[s("全部项目",-1)])),_:1,__:[4]}),(_(!0),b(X,null,Y(N.value,t=>(_(),x(d,{key:t.id,value:t.id},{default:a(()=>[s(i(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(r,{span:6},{default:a(()=>[o(f,{modelValue:c.status,"onUpdate:modelValue":e[1]||(e[1]=t=>c.status=t),placeholder:"选择状态","allow-clear":"",onChange:u},{default:a(()=>[o(d,{value:""},{default:a(()=>e[5]||(e[5]=[s("全部状态",-1)])),_:1,__:[5]}),o(d,{value:"PENDING"},{default:a(()=>e[6]||(e[6]=[s("等待中",-1)])),_:1,__:[6]}),o(d,{value:"RUNNING"},{default:a(()=>e[7]||(e[7]=[s("运行中",-1)])),_:1,__:[7]}),o(d,{value:"SUCCESS"},{default:a(()=>e[8]||(e[8]=[s("成功",-1)])),_:1,__:[8]}),o(d,{value:"FAILED"},{default:a(()=>e[9]||(e[9]=[s("失败",-1)])),_:1,__:[9]})]),_:1},8,["modelValue"])]),_:1}),o(r,{span:8},{default:a(()=>[o(h,{modelValue:c.dateRange,"onUpdate:modelValue":e[2]||(e[2]=t=>c.dateRange=t),onChange:u},null,8,["modelValue"])]),_:1}),o(r,{span:4},{default:a(()=>[o(g,{onClick:u},{icon:a(()=>[o(D(E))]),default:a(()=>[e[10]||(e[10]=s(" 刷新 ",-1))]),_:1,__:[10]})]),_:1})]),_:1})]),l("div",ge,[o(W,{columns:k,data:I.value,loading:w.value,pagination:m,onPageChange:T,onPageSizeChange:M},{project:a(({record:t})=>[l("div",null,[l("p",pe,i(t.project?.name||"未知项目"),1),l("p",fe,"ID: "+i(t.project_id),1)])]),image_tag:a(({record:t})=>[l("code",be,i(t.image_tag),1)]),status:a(({record:t})=>[l("div",ve,[l("div",{class:ae(["w-2 h-2 rounded-full",P(t.status)])},null,2),o(G,{color:R(t.status)},{default:a(()=>[s(i(U(t.status)),1)]),_:2},1032,["color"])])]),duration:a(({record:t})=>[s(i(L(t.created_at,t.updated_at)),1)]),created_at:a(({record:t})=>[s(i(V(t.created_at)),1)]),actions:a(({record:t})=>[o(O,null,{default:a(()=>[o(g,{type:"text",size:"small",onClick:H=>z(t)},{icon:a(()=>[o($)]),default:a(()=>[e[11]||(e[11]=s(" 查看日志 ",-1))]),_:2,__:[11]},1032,["onClick"]),t.status==="FAILED"?(_(),x(g,{key:0,type:"text",size:"small",onClick:H=>A(t)},{icon:a(()=>[o(D(E))]),default:a(()=>[e[12]||(e[12]=s(" 重新构建 ",-1))]),_:2,__:[12]},1032,["onClick"])):ee("",!0)]),_:2},1024)]),_:1},8,["data","loading","pagination"])]),o(q,{visible:S.value,"onUpdate:visible":e[3]||(e[3]=t=>S.value=t),title:"构建日志",width:"80%",footer:!1},{default:a(()=>[l("div",we,[C.value?(_(),b("pre",Se,i(C.value),1)):(_(),b("div",Ce,"暂无日志信息"))])]),_:1},8,["visible"])])}}});export{Re as default};
