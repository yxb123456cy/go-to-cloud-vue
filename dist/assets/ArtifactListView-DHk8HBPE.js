import{d as q,r as _,a as D,z as G,c as v,o as u,b as l,f as r,w as t,M as c,B as Q,g as n,j as w,F as I,s as x,t as C,v as d,i as X}from"./index-CWkTdfTI.js";import"./index-BBxfLePQ.js";import{S as Z,O as ee}from"./index-Cnpsw9AU.js";import{T as te}from"./index-BnQlv6tf.js";import{T as ae}from"./index-Bj-pk1Oh.js";import{R as oe,C as re,b as ne,c as le}from"./index-C7QiuXXS.js";import{S as de}from"./index-DaljsaQM.js";import{I as ie}from"./index-BUX5n9pn.js";import{I as se}from"./index-r_DMoUNl.js";import{I as ce}from"./index-KzVAYis5.js";import{M as ue}from"./index-DKM5Hh1L.js";const pe={class:"p-6"},_e={class:"flex items-center justify-between mb-6"},me={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},fe={class:"bg-white rounded-lg shadow-sm border border-gray-200"},ge={class:"font-medium text-gray-900"},ye={class:"text-sm text-gray-500"},ve={class:"text-sm text-gray-600"},we={class:"text-sm text-gray-600"},De=q({__name:"ArtifactListView",setup(he){const M=X(),h=_(!1),k=_([]),N=_([]),S=_([]),V=_([]),f=_([]),s=D({projectId:"",typeId:"",repoId:"",keyword:""}),m=D({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:!0}),R=[{title:"制品信息",dataIndex:"name",slotName:"name",width:250},{title:"版本",dataIndex:"version",slotName:"version",width:120},{title:"类型",dataIndex:"type",slotName:"type",width:100},{title:"所属项目",dataIndex:"project",slotName:"project",width:150},{title:"仓库",dataIndex:"repo",slotName:"repo",width:120},{title:"创建时间",dataIndex:"created_at",slotName:"created_at",width:180},{title:"操作",slotName:"actions",width:180,align:"center"}];function z(o){return new Date(o).toLocaleString("zh-CN")}function T(o){return{DOCKER:"blue",NPM:"green",JAR:"orange",MAVEN:"red",PYPI:"yellow"}[o||""]||"gray"}function O(o){m.current=o,i()}function $(o){m.pageSize=o,m.current=1,i()}function B(o){M.push(`/artifacts/${o.id}`)}async function E(o){try{f.value.push(o.id),c.success(`制品 ${o.name} 下载开始`)}catch(a){console.error(a),c.error("下载失败")}finally{f.value=f.value.filter(a=>a!==o.id)}}function J(o){ue.confirm({title:"确认删除",content:`确定要删除制品 "${o.name}:${o.version}" 吗？此操作不可恢复。`,onOk:async()=>{try{c.success("删除成功"),i()}catch(a){console.error(a),c.error("删除失败")}}})}function U(){i()}async function K(){try{N.value=[{id:1,name:"Web前端项目",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""},{id:2,name:"API服务",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""}]}catch(o){console.error(o),c.error("加载项目列表失败")}}async function L(){try{S.value=[{id:1,name:"DOCKER",description:"Docker镜像",created_at:""},{id:2,name:"NPM",description:"NPM包",created_at:""},{id:3,name:"JAR",description:"Java JAR包",created_at:""}]}catch(o){console.error(o),c.error("加载制品类型失败")}}async function F(){try{V.value=[{id:1,name:"Docker Hub",type_id:1,url:"docker.io",created_at:"",updated_at:""},{id:2,name:"NPM Registry",type_id:2,url:"registry.npmjs.org",created_at:"",updated_at:""}]}catch(o){console.error(o),c.error("加载制品仓库失败")}}async function i(){try{h.value=!0,k.value=[{id:1,project_id:1,repo_id:1,name:"web-frontend",version:"v1.0.0",type_id:1,path:"myorg/web-frontend:v1.0.0",created_at:new Date().toISOString(),project:{id:1,name:"Web前端项目",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""},artifact_repo:{id:1,name:"Docker Hub",type_id:1,url:"docker.io",created_at:"",updated_at:""},artifact_type:{id:1,name:"DOCKER",description:"Docker镜像",created_at:""}},{id:2,project_id:2,repo_id:2,name:"@myorg/api-utils",version:"2.1.0",type_id:2,path:"@myorg/api-utils",created_at:new Date(Date.now()-864e5).toISOString(),project:{id:2,name:"API服务",repo_url:"",branch:"",build_cmd:"",image_name:"",created_at:"",updated_at:""},artifact_repo:{id:2,name:"NPM Registry",type_id:2,url:"registry.npmjs.org",created_at:"",updated_at:""},artifact_type:{id:2,name:"NPM",description:"NPM包",created_at:""}}],m.total=2}catch(o){console.error(o),c.error("加载制品列表失败")}finally{h.value=!1}}return G(()=>{K(),L(),F(),i()}),(o,a)=>{const g=Q,P=de,p=ee,b=Z,y=re,H=ne,W=oe,j=te,Y=ae;return u(),v("div",pe,[l("div",_e,[a[5]||(a[5]=l("div",null,[l("h1",{class:"text-2xl font-bold text-gray-900 mb-2"}," 制品列表 "),l("p",{class:"text-gray-600"}," 查看和管理所有制品 ")],-1)),r(P,null,{default:t(()=>[r(g,{onClick:U},{icon:t(()=>[r(w(ie))]),default:t(()=>[a[4]||(a[4]=n(" 刷新 ",-1))]),_:1,__:[4]})]),_:1})]),l("div",me,[r(W,{gutter:16},{default:t(()=>[r(y,{span:5},{default:t(()=>[r(b,{modelValue:s.projectId,"onUpdate:modelValue":a[0]||(a[0]=e=>s.projectId=e),placeholder:"选择项目","allow-clear":"",onChange:i},{default:t(()=>[r(p,{value:""},{default:t(()=>a[6]||(a[6]=[n(" 全部项目 ",-1)])),_:1,__:[6]}),(u(!0),v(I,null,x(N.value,e=>(u(),C(p,{key:e.id,value:e.id},{default:t(()=>[n(d(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(y,{span:5},{default:t(()=>[r(b,{modelValue:s.typeId,"onUpdate:modelValue":a[1]||(a[1]=e=>s.typeId=e),placeholder:"选择类型","allow-clear":"",onChange:i},{default:t(()=>[r(p,{value:""},{default:t(()=>a[7]||(a[7]=[n(" 全部类型 ",-1)])),_:1,__:[7]}),(u(!0),v(I,null,x(S.value,e=>(u(),C(p,{key:e.id,value:e.id},{default:t(()=>[n(d(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(y,{span:5},{default:t(()=>[r(b,{modelValue:s.repoId,"onUpdate:modelValue":a[2]||(a[2]=e=>s.repoId=e),placeholder:"选择仓库","allow-clear":"",onChange:i},{default:t(()=>[r(p,{value:""},{default:t(()=>a[8]||(a[8]=[n(" 全部仓库 ",-1)])),_:1,__:[8]}),(u(!0),v(I,null,x(V.value,e=>(u(),C(p,{key:e.id,value:e.id},{default:t(()=>[n(d(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(y,{span:9},{default:t(()=>[r(H,{modelValue:s.keyword,"onUpdate:modelValue":a[3]||(a[3]=e=>s.keyword=e),placeholder:"搜索制品名称或版本",onSearch:i},null,8,["modelValue"])]),_:1})]),_:1})]),l("div",fe,[r(Y,{columns:R,data:k.value,loading:h.value,pagination:m,onPageChange:O,onPageSizeChange:$},{name:t(({record:e})=>[l("div",null,[l("p",ge,d(e.name),1),l("p",ye,d(e.path),1)])]),version:t(({record:e})=>[r(j,{color:"blue"},{default:t(()=>[n(d(e.version),1)]),_:2},1024)]),type:t(({record:e})=>[r(j,{color:T(e.artifact_type?.name)},{default:t(()=>[n(d(e.artifact_type?.name||"未知"),1)]),_:2},1032,["color"])]),project:t(({record:e})=>[l("span",ve,d(e.project?.name||"未知项目"),1)]),repo:t(({record:e})=>[l("span",we,d(e.artifact_repo?.name||"未知仓库"),1)]),created_at:t(({record:e})=>[n(d(z(e.created_at)),1)]),actions:t(({record:e})=>[r(P,null,{default:t(()=>[r(g,{type:"text",size:"small",onClick:A=>B(e)},{icon:t(()=>[r(w(le))]),default:t(()=>[a[9]||(a[9]=n(" 详情 ",-1))]),_:2,__:[9]},1032,["onClick"]),r(g,{type:"text",size:"small",loading:f.value.includes(e.id),onClick:A=>E(e)},{icon:t(()=>[r(w(se))]),default:t(()=>[a[10]||(a[10]=n(" 下载 ",-1))]),_:2,__:[10]},1032,["loading","onClick"]),r(g,{type:"text",size:"small",status:"danger",onClick:A=>J(e)},{icon:t(()=>[r(w(ce))]),default:t(()=>[a[11]||(a[11]=n(" 删除 ",-1))]),_:2,__:[11]},1032,["onClick"])]),_:2},1024)]),_:1},8,["data","loading","pagination"])])])}}});export{De as default};
