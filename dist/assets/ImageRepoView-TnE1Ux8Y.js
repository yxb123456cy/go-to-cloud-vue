import{d as G,r as d,a as x,E as J,c as K,o as Q,b as s,f as t,w as o,B as X,M as r,g as u,j as m,v as y,l as D}from"./index-DJUXxr88.js";/* empty css              */import{R as Y,C as Z,b as ee,I as te,a as ae}from"./index-CuqxcLwh.js";import{F as oe,a as ne}from"./index-BDGnSADg.js";import{A as le,I as se}from"./index-C5dRKA4B.js";import"./index-CK5aMVwv.js";import"./index-DjVtTPI3.js";import"./index-CWyVRzfV.js";import{T as re,I as ie}from"./index-DSuL0VRM.js";import{S as ue}from"./index-DnnkudhW.js";import{M as z}from"./index-jzJlBcrn.js";import{I as de}from"./index-BImJgcX3.js";import{I as me}from"./index-bKVfasY4.js";import{I as ce}from"./index-BAMwCS0H.js";import{I as pe}from"./index-DiwGP3IF.js";const fe={class:"p-6"},_e={class:"flex items-center justify-between mb-6"},ge={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},ve={class:"bg-white rounded-lg shadow-sm border border-gray-200"},we={class:"font-medium text-gray-900"},ye={class:"text-sm text-gray-500"},Ie={class:"flex items-center space-x-2"},Be=G({__name:"ImageRepoView",setup(be){const c=d(!1),p=d(!1),f=d(null),C=d([]),v=d([]),I=d(),l=x({name:"",url:"",username:"",password:""}),h=x({keyword:""}),_=x({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:!0}),N=[{title:"仓库信息",dataIndex:"name",slotName:"name",width:300},{title:"认证状态",dataIndex:"auth",slotName:"auth",width:120},{title:"创建时间",dataIndex:"created_at",slotName:"created_at",width:180},{title:"操作",slotName:"actions",width:200,align:"center"}],$={name:[{required:!0,message:"请输入仓库名称"},{minLength:2,message:"仓库名称至少2个字符"}],url:[{required:!0,message:"请输入仓库地址"}]};function M(n){return new Date(n).toLocaleString("zh-CN")}function S(){l.name="",l.url="",l.username="",l.password="",f.value=null,p.value=!1,I.value?.resetFields()}function O(n){_.current=n,i()}function P(n){_.pageSize=n,_.current=1,i()}function R(n){f.value=n,l.name=n.name,l.url=n.url,l.username=n.username||"",l.password="",p.value=!0}function U(n){z.confirm({title:"确认删除",content:`确定要删除镜像仓库 "${n.name}" 吗？此操作不可恢复。`,onOk:async()=>{try{r.success("删除成功"),i()}catch(e){console.error(e),r.error("删除失败")}}})}async function B(n){try{v.value.push(n.id),r.success(`镜像仓库 ${n.name} 连接正常`)}catch(e){console.error(e),r.error(`镜像仓库 ${n.name} 连接失败`)}finally{v.value=v.value.filter(e=>e!==n.id)}}async function F(){try{if(!await I.value?.validate())return;c.value=!0,f.value?r.success("更新成功"):r.success("添加成功"),S(),i()}catch(n){console.error(n),r.error(f.value?"更新失败":"添加失败")}finally{c.value=!1}}async function i(){try{c.value=!0,C.value=[{id:1,name:"Docker Hub",url:"docker.io",username:"myuser",password:"***",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:2,name:"私有仓库",url:"registry.example.com",username:"",password:"",created_at:new Date(Date.now()-864e5).toISOString(),updated_at:new Date(Date.now()-864e5).toISOString()}],_.total=2}catch(n){console.error(n),r.error("加载镜像仓库列表失败")}finally{c.value=!1}}return J(()=>{i()}),(n,e)=>{const g=X,T=ee,k=Z,E=Y,j=ue,q=re,b=te,w=ne,A=ae,L=le,H=oe,W=z;return Q(),K("div",fe,[s("div",_e,[e[8]||(e[8]=s("div",null,[s("h1",{class:"text-2xl font-bold text-gray-900 mb-2"}," 镜像仓库管理 "),s("p",{class:"text-gray-600"}," 管理Docker镜像仓库配置 ")],-1)),t(g,{type:"primary",onClick:e[0]||(e[0]=a=>p.value=!0)},{icon:o(()=>[t(m(ie))]),default:o(()=>[e[7]||(e[7]=u(" 添加仓库 ",-1))]),_:1,__:[7]})]),s("div",ge,[t(E,{gutter:16},{default:o(()=>[t(k,{span:8},{default:o(()=>[t(T,{modelValue:h.keyword,"onUpdate:modelValue":e[1]||(e[1]=a=>h.keyword=a),placeholder:"搜索仓库名称或地址",onSearch:i},null,8,["modelValue"])]),_:1}),t(k,{span:4},{default:o(()=>[t(g,{onClick:i},{icon:o(()=>[t(m(de))]),default:o(()=>[e[9]||(e[9]=u(" 刷新 ",-1))]),_:1,__:[9]})]),_:1})]),_:1})]),s("div",ve,[t(q,{columns:N,data:C.value,loading:c.value,pagination:_,onPageChange:O,onPageSizeChange:P},{name:o(({record:a})=>[s("div",null,[s("p",we,y(a.name),1),s("p",ye,y(a.url),1)])]),auth:o(({record:a})=>[s("div",Ie,[s("div",{class:D(["w-2 h-2 rounded-full",a.username?"bg-green-500":"bg-gray-400"])},null,2),s("span",{class:D(["text-sm",a.username?"text-green-600":"text-gray-500"])},y(a.username?"已配置认证":"无认证"),3)])]),created_at:o(({record:a})=>[u(y(M(a.created_at)),1)]),actions:o(({record:a})=>[t(j,null,{default:o(()=>[t(g,{type:"text",size:"small",loading:v.value.includes(a.id),onClick:V=>B(a)},{icon:o(()=>[t(m(me))]),default:o(()=>[e[10]||(e[10]=u(" 测试连接 ",-1))]),_:2,__:[10]},1032,["loading","onClick"]),t(g,{type:"text",size:"small",onClick:V=>R(a)},{icon:o(()=>[t(m(ce))]),default:o(()=>[e[11]||(e[11]=u(" 编辑 ",-1))]),_:2,__:[11]},1032,["onClick"]),t(g,{type:"text",size:"small",status:"danger",onClick:V=>U(a)},{icon:o(()=>[t(m(pe))]),default:o(()=>[e[12]||(e[12]=u(" 删除 ",-1))]),_:2,__:[12]},1032,["onClick"])]),_:2},1024)]),_:1},8,["data","loading","pagination"])]),t(W,{visible:p.value,"onUpdate:visible":e[6]||(e[6]=a=>p.value=a),title:f.value?"编辑镜像仓库":"添加镜像仓库",width:"600px",onOk:F,onCancel:S},{default:o(()=>[t(H,{ref_key:"formRef",ref:I,model:l,rules:$,layout:"vertical"},{default:o(()=>[t(w,{field:"name",label:"仓库名称"},{default:o(()=>[t(b,{modelValue:l.name,"onUpdate:modelValue":e[2]||(e[2]=a=>l.name=a),placeholder:"请输入仓库名称"},null,8,["modelValue"])]),_:1}),t(w,{field:"url",label:"仓库地址"},{default:o(()=>[t(b,{modelValue:l.url,"onUpdate:modelValue":e[3]||(e[3]=a=>l.url=a),placeholder:"请输入仓库地址，如：registry.example.com"},null,8,["modelValue"])]),_:1}),t(w,{field:"username",label:"用户名"},{default:o(()=>[t(b,{modelValue:l.username,"onUpdate:modelValue":e[4]||(e[4]=a=>l.username=a),placeholder:"请输入用户名（可选）"},null,8,["modelValue"])]),_:1}),t(w,{field:"password",label:"密码"},{default:o(()=>[t(A,{modelValue:l.password,"onUpdate:modelValue":e[5]||(e[5]=a=>l.password=a),placeholder:"请输入密码（可选）"},null,8,["modelValue"])]),_:1}),t(L,{type:"info",class:"mt-4"},{icon:o(()=>[t(m(se))]),default:o(()=>[e[13]||(e[13]=u(" 密码将被加密存储。如果不填写认证信息，将使用匿名访问。 ",-1))]),_:1,__:[13]})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}});export{Be as default};
