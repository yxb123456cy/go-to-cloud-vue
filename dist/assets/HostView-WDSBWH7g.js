import{d as te,r as c,a as N,z as ae,c as S,o as I,b as r,f as o,w as a,B as oe,M as u,g as s,j as h,F as D,s as E,t as P,v as m,l as ne}from"./index-CWkTdfTI.js";/* empty css              */import{R as le,C as se,b as re,I as ue}from"./index-C7QiuXXS.js";import{F as de,a as ie}from"./index-IpKDLcLY.js";import"./index-BBxfLePQ.js";/* empty css              */import{S as me,O as pe}from"./index-Cnpsw9AU.js";import{T as _e}from"./index-BnQlv6tf.js";import{T as ce,I as fe,a as ge}from"./index-Bj-pk1Oh.js";import{S as ve}from"./index-DaljsaQM.js";import{M as U}from"./index-DKM5Hh1L.js";import{I as ye}from"./index-BUX5n9pn.js";import{I as Ie}from"./index-BvnK8PVc.js";import{I as he}from"./index-17ckrZER.js";import{I as we}from"./index-KzVAYis5.js";const be={class:"p-6 bg-gray-50 min-h-screen"},Ve={class:"flex items-center justify-between mb-6"},Ce={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},xe={class:"bg-white rounded-lg shadow-sm border border-gray-200"},Ne={class:"font-medium text-gray-900"},Se={class:"text-sm text-gray-500"},ke={class:"flex items-center space-x-2"},Ae=te({__name:"HostView",setup(Oe){const d=c(!1),f=c(!1),g=c(null),k=c([]),V=c([]),C=c(),l=N({host_group_id:0,name:"",ip:"",port:8080}),p=N({hostGroupId:"",status:"",keyword:""}),v=N({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:!0}),G=[{title:"主机信息",dataIndex:"name",slotName:"name",width:250},{title:"主机组",dataIndex:"host_group",slotName:"hostGroup",width:120},{title:"状态",dataIndex:"status",slotName:"status",width:100},{title:"创建时间",dataIndex:"created_at",slotName:"created_at",width:180},{title:"操作",slotName:"actions",width:200,align:"center"}],H={host_group_id:[{required:!0,message:"请选择主机组"}],name:[{required:!0,message:"请输入主机名称"},{minLength:2,message:"主机名称至少2个字符"}],ip:[{required:!0,message:"请输入IP地址"}],port:[{required:!0,message:"请输入端口号"},{type:"number",min:1,max:65535,message:"端口号范围1-65535"}]};function T(n){return new Date(n).toLocaleString("zh-CN")}function O(){l.host_group_id=0,l.name="",l.ip="",l.port=8080,g.value=null,f.value=!1,C.value?.resetFields()}function $(n){v.current=n,i()}function B(n){v.pageSize=n,v.current=1,i()}function M(n){g.value=n,l.host_group_id=n.host_group_id,l.name=n.name,l.ip=n.ip,l.port=n.port,f.value=!0}function R(n){U.confirm({title:"确认删除",content:`确定要删除主机 "${n.name}" 吗？此操作不可恢复。`,onOk:async()=>{try{u.success("删除成功"),i()}catch(e){console.error(e),u.error("删除失败")}}})}async function q(n){try{d.value=!0,u.success(`主机 ${n.name} 连接正常`)}catch(e){console.error(e),u.error(`主机 ${n.name} 连接失败`)}finally{d.value=!1}}async function A(){try{d.value=!0,u.success("状态刷新完成"),i()}catch(n){console.error(n),u.error("刷新状态失败")}finally{d.value=!1}}async function j(){try{if(!await C.value?.validate())return;d.value=!0,g.value?u.success("更新成功"):u.success("添加成功"),O(),i()}catch(n){console.error(n),u.error(g.value?"更新失败":"添加失败")}finally{d.value=!1}}async function W(){try{V.value=[{id:1,name:"生产环境",description:"生产环境服务器组",created_at:"",updated_at:""},{id:2,name:"测试环境",description:"测试环境服务器组",created_at:"",updated_at:""}]}catch(n){console.error(n),u.error("加载主机组失败")}}async function i(){try{d.value=!0,k.value=[{id:1,host_group_id:1,name:"生产服务器1",ip:"192.168.1.100",port:8080,status:"ONLINE",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),host_group:{id:1,name:"生产环境",description:"",created_at:"",updated_at:""}},{id:2,host_group_id:1,name:"生产服务器2",ip:"192.168.1.101",port:8080,status:"OFFLINE",created_at:new Date(Date.now()-864e5).toISOString(),updated_at:new Date(Date.now()-864e5).toISOString(),host_group:{id:1,name:"生产环境",description:"",created_at:"",updated_at:""}}],v.total=2}catch(n){console.error(n),u.error("加载主机列表失败")}finally{d.value=!1}}return ae(()=>{W(),i()}),(n,e)=>{const y=oe,_=pe,x=me,w=se,J=re,K=le,z=_e,Q=ve,X=ce,b=ie,F=ue,Y=ge,Z=de,ee=U;return I(),S("div",be,[r("div",Ve,[e[10]||(e[10]=r("div",null,[r("h1",{class:"text-2xl font-bold text-gray-900 mb-2"}," 主机管理 "),r("p",{class:"text-gray-600"}," 管理部署目标主机（Agent节点） ")],-1)),o(y,{type:"primary",onClick:e[0]||(e[0]=t=>f.value=!0)},{icon:a(()=>[o(h(fe))]),default:a(()=>[e[9]||(e[9]=s(" 添加主机 ",-1))]),_:1,__:[9]})]),r("div",Ce,[o(K,{gutter:16},{default:a(()=>[o(w,{span:6},{default:a(()=>[o(x,{modelValue:p.hostGroupId,"onUpdate:modelValue":e[1]||(e[1]=t=>p.hostGroupId=t),placeholder:"选择主机组","allow-clear":"",onChange:i},{default:a(()=>[o(_,{value:""},{default:a(()=>e[11]||(e[11]=[s(" 全部主机组 ",-1)])),_:1,__:[11]}),(I(!0),S(D,null,E(V.value,t=>(I(),P(_,{key:t.id,value:t.id},{default:a(()=>[s(m(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(w,{span:6},{default:a(()=>[o(x,{modelValue:p.status,"onUpdate:modelValue":e[2]||(e[2]=t=>p.status=t),placeholder:"选择状态","allow-clear":"",onChange:i},{default:a(()=>[o(_,{value:""},{default:a(()=>e[12]||(e[12]=[s(" 全部状态 ",-1)])),_:1,__:[12]}),o(_,{value:"ONLINE"},{default:a(()=>e[13]||(e[13]=[s(" 在线 ",-1)])),_:1,__:[13]}),o(_,{value:"OFFLINE"},{default:a(()=>e[14]||(e[14]=[s(" 离线 ",-1)])),_:1,__:[14]})]),_:1},8,["modelValue"])]),_:1}),o(w,{span:8},{default:a(()=>[o(J,{modelValue:p.keyword,"onUpdate:modelValue":e[3]||(e[3]=t=>p.keyword=t),placeholder:"搜索主机名称或IP",onSearch:i},null,8,["modelValue"])]),_:1}),o(w,{span:4},{default:a(()=>[o(y,{onClick:A},{icon:a(()=>[o(h(ye))]),default:a(()=>[e[15]||(e[15]=s(" 刷新状态 ",-1))]),_:1,__:[15]})]),_:1})]),_:1})]),r("div",xe,[o(X,{columns:G,data:k.value,loading:d.value,pagination:v,onPageChange:$,onPageSizeChange:B},{name:a(({record:t})=>[r("div",null,[r("p",Ne,m(t.name),1),r("p",Se,m(t.ip)+":"+m(t.port),1)])]),hostGroup:a(({record:t})=>[o(z,{color:"blue"},{default:a(()=>[s(m(t.host_group?.name||"未分组"),1)]),_:2},1024)]),status:a(({record:t})=>[r("div",ke,[r("div",{class:ne(["w-2 h-2 rounded-full",t.status==="ONLINE"?"bg-green-500":"bg-red-500"])},null,2),o(z,{color:t.status==="ONLINE"?"green":"red"},{default:a(()=>[s(m(t.status==="ONLINE"?"在线":"离线"),1)]),_:2},1032,["color"])])]),created_at:a(({record:t})=>[s(m(T(t.created_at)),1)]),actions:a(({record:t})=>[o(Q,null,{default:a(()=>[o(y,{type:"text",size:"small",onClick:L=>q(t)},{icon:a(()=>[o(h(Ie))]),default:a(()=>[e[16]||(e[16]=s(" 测试连接 ",-1))]),_:2,__:[16]},1032,["onClick"]),o(y,{type:"text",size:"small",onClick:L=>M(t)},{icon:a(()=>[o(h(he))]),default:a(()=>[e[17]||(e[17]=s(" 编辑 ",-1))]),_:2,__:[17]},1032,["onClick"]),o(y,{type:"text",size:"small",status:"danger",onClick:L=>R(t)},{icon:a(()=>[o(h(we))]),default:a(()=>[e[18]||(e[18]=s(" 删除 ",-1))]),_:2,__:[18]},1032,["onClick"])]),_:2},1024)]),_:1},8,["data","loading","pagination"])]),o(ee,{visible:f.value,"onUpdate:visible":e[8]||(e[8]=t=>f.value=t),title:g.value?"编辑主机":"添加主机",onOk:j,onCancel:O},{default:a(()=>[o(Z,{ref_key:"formRef",ref:C,model:l,rules:H,layout:"vertical"},{default:a(()=>[o(b,{field:"host_group_id",label:"主机组"},{default:a(()=>[o(x,{modelValue:l.host_group_id,"onUpdate:modelValue":e[4]||(e[4]=t=>l.host_group_id=t),placeholder:"请选择主机组"},{default:a(()=>[(I(!0),S(D,null,E(V.value,t=>(I(),P(_,{key:t.id,value:t.id},{default:a(()=>[s(m(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(b,{field:"name",label:"主机名称"},{default:a(()=>[o(F,{modelValue:l.name,"onUpdate:modelValue":e[5]||(e[5]=t=>l.name=t),placeholder:"请输入主机名称"},null,8,["modelValue"])]),_:1}),o(b,{field:"ip",label:"IP地址"},{default:a(()=>[o(F,{modelValue:l.ip,"onUpdate:modelValue":e[6]||(e[6]=t=>l.ip=t),placeholder:"请输入IP地址或域名"},null,8,["modelValue"])]),_:1}),o(b,{field:"port",label:"Agent端口"},{default:a(()=>[o(Y,{modelValue:l.port,"onUpdate:modelValue":e[7]||(e[7]=t=>l.port=t),placeholder:"请输入Agent服务端口",min:1,max:65535},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}});export{Ae as default};
