import{d as ne,r as m,a as S,x as le,c as M,o as w,b as r,f as o,w as a,B as re,M as d,g as s,j as c,F as R,s as O,t as z,v as u,l as T}from"./index-XeR4dm_A.js";/* empty css              */import{R as se,C as de,b as ie,I as ue,a as me}from"./index-_Le4l-FT.js";import{F as ce,a as pe}from"./index-DblMJEe-.js";import{A as _e,I as fe}from"./index-Beqz0hwn.js";import"./index-CG2D6ptY.js";import{S as ge,O as ye}from"./index-DEcwfKP5.js";import{T as ve}from"./index-k17B4Fwt.js";import{T as we,I as Ie}from"./index-eIo3eb-K.js";import{S as be}from"./index-Bi8GYVuf.js";import{M as U}from"./index-DUMfmY3d.js";import{I as Ce}from"./index-CHSk6fru.js";import{I as Ve}from"./index-CrL8y1O6.js";import{I as xe}from"./index-Bqg0be0K.js";import{I as ke}from"./index-MIkPKJzQ.js";const he={class:"p-6"},Se={class:"flex items-center justify-between mb-6"},Me={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6"},Ne={class:"bg-white rounded-lg shadow-sm border border-gray-200"},Pe={class:"font-medium text-gray-900"},De={class:"text-sm text-gray-500"},Ae={class:"flex items-center space-x-2"},We=ne({__name:"ArtifactRepoView",setup(Re){const p=m(!1),_=m(!1),f=m(null),N=m([]),C=m([]),I=m([]),V=m(),l=S({name:"",type_id:0,url:"",username:"",password:""}),b=S({typeId:"",keyword:""}),g=S({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:!0}),E=[{title:"仓库信息",dataIndex:"name",slotName:"name",width:300},{title:"制品类型",dataIndex:"type",slotName:"type",width:120},{title:"认证状态",dataIndex:"auth",slotName:"auth",width:120},{title:"创建时间",dataIndex:"created_at",slotName:"created_at",width:180},{title:"操作",slotName:"actions",width:200,align:"center"}],F={name:[{required:!0,message:"请输入仓库名称"},{minLength:2,message:"仓库名称至少2个字符"}],type_id:[{required:!0,message:"请选择制品类型"}],url:[{required:!0,message:"请输入仓库地址"}]};function $(n){return new Date(n).toLocaleString("zh-CN")}function B(n){return{DOCKER:"blue",NPM:"green",JAR:"orange",MAVEN:"red",PYPI:"yellow"}[n||""]||"gray"}function P(){l.name="",l.type_id=0,l.url="",l.username="",l.password="",f.value=null,_.value=!1,V.value?.resetFields()}function J(n){g.current=n,i()}function j(n){g.pageSize=n,g.current=1,i()}function q(n){f.value=n,l.name=n.name,l.type_id=n.type_id,l.url=n.url,l.username=n.username||"",l.password="",_.value=!0}function K(n){U.confirm({title:"确认删除",content:`确定要删除制品仓库 "${n.name}" 吗？此操作不可恢复。`,onOk:async()=>{try{d.success("删除成功"),i()}catch(t){console.error(t),d.error("删除失败")}}})}async function L(n){try{I.value.push(n.id),d.success(`制品仓库 ${n.name} 连接正常`)}catch(t){console.error(t),d.error(`制品仓库 ${n.name} 连接失败`)}finally{I.value=I.value.filter(t=>t!==n.id)}}async function Y(){try{if(!await V.value?.validate())return;p.value=!0,f.value?d.success("更新成功"):d.success("添加成功"),P(),i()}catch(n){console.error(n),d.error(f.value?"更新失败":"添加失败")}finally{p.value=!1}}async function H(){try{C.value=[{id:1,name:"DOCKER",description:"Docker镜像",created_at:""},{id:2,name:"NPM",description:"NPM包",created_at:""},{id:3,name:"JAR",description:"Java JAR包",created_at:""},{id:4,name:"MAVEN",description:"Maven仓库",created_at:""},{id:5,name:"PYPI",description:"Python包",created_at:""}]}catch(n){console.error(n),d.error("加载制品类型失败")}}async function i(){try{p.value=!0,N.value=[{id:1,name:"Docker Hub",type_id:1,url:"docker.io",username:"myuser",password:"***",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),artifact_type:{id:1,name:"DOCKER",description:"Docker镜像",created_at:""}},{id:2,name:"NPM Registry",type_id:2,url:"registry.npmjs.org",username:"",password:"",created_at:new Date(Date.now()-864e5).toISOString(),updated_at:new Date(Date.now()-864e5).toISOString(),artifact_type:{id:2,name:"NPM",description:"NPM包",created_at:""}}],g.total=2}catch(n){console.error(n),d.error("加载制品仓库列表失败")}finally{p.value=!1}}return le(()=>{H(),i()}),(n,t)=>{const y=re,x=ye,D=ge,k=de,W=ie,G=se,Q=ve,X=be,Z=we,h=ue,v=pe,ee=me,te=_e,ae=ce,oe=U;return w(),M("div",he,[r("div",Se,[t[10]||(t[10]=r("div",null,[r("h1",{class:"text-2xl font-bold text-gray-900 mb-2"}," 制品仓库管理 "),r("p",{class:"text-gray-600"}," 管理各类制品仓库配置 ")],-1)),o(y,{type:"primary",onClick:t[0]||(t[0]=e=>_.value=!0)},{icon:a(()=>[o(c(Ie))]),default:a(()=>[t[9]||(t[9]=s(" 添加仓库 ",-1))]),_:1,__:[9]})]),r("div",Me,[o(G,{gutter:16},{default:a(()=>[o(k,{span:6},{default:a(()=>[o(D,{modelValue:b.typeId,"onUpdate:modelValue":t[1]||(t[1]=e=>b.typeId=e),placeholder:"选择制品类型","allow-clear":"",onChange:i},{default:a(()=>[o(x,{value:""},{default:a(()=>t[11]||(t[11]=[s(" 全部类型 ",-1)])),_:1,__:[11]}),(w(!0),M(R,null,O(C.value,e=>(w(),z(x,{key:e.id,value:e.id},{default:a(()=>[s(u(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(k,{span:8},{default:a(()=>[o(W,{modelValue:b.keyword,"onUpdate:modelValue":t[2]||(t[2]=e=>b.keyword=e),placeholder:"搜索仓库名称或地址",onSearch:i},null,8,["modelValue"])]),_:1}),o(k,{span:4},{default:a(()=>[o(y,{onClick:i},{icon:a(()=>[o(c(Ce))]),default:a(()=>[t[12]||(t[12]=s(" 刷新 ",-1))]),_:1,__:[12]})]),_:1})]),_:1})]),r("div",Ne,[o(Z,{columns:E,data:N.value,loading:p.value,pagination:g,onPageChange:J,onPageSizeChange:j},{name:a(({record:e})=>[r("div",null,[r("p",Pe,u(e.name),1),r("p",De,u(e.url),1)])]),type:a(({record:e})=>[o(Q,{color:B(e.artifact_type?.name)},{default:a(()=>[s(u(e.artifact_type?.name||"未知类型"),1)]),_:2},1032,["color"])]),auth:a(({record:e})=>[r("div",Ae,[r("div",{class:T(["w-2 h-2 rounded-full",e.username?"bg-green-500":"bg-gray-400"])},null,2),r("span",{class:T(["text-sm",e.username?"text-green-600":"text-gray-500"])},u(e.username?"已配置认证":"无认证"),3)])]),created_at:a(({record:e})=>[s(u($(e.created_at)),1)]),actions:a(({record:e})=>[o(X,null,{default:a(()=>[o(y,{type:"text",size:"small",loading:I.value.includes(e.id),onClick:A=>L(e)},{icon:a(()=>[o(c(Ve))]),default:a(()=>[t[13]||(t[13]=s(" 测试连接 ",-1))]),_:2,__:[13]},1032,["loading","onClick"]),o(y,{type:"text",size:"small",onClick:A=>q(e)},{icon:a(()=>[o(c(xe))]),default:a(()=>[t[14]||(t[14]=s(" 编辑 ",-1))]),_:2,__:[14]},1032,["onClick"]),o(y,{type:"text",size:"small",status:"danger",onClick:A=>K(e)},{icon:a(()=>[o(c(ke))]),default:a(()=>[t[15]||(t[15]=s(" 删除 ",-1))]),_:2,__:[15]},1032,["onClick"])]),_:2},1024)]),_:1},8,["data","loading","pagination"])]),o(oe,{visible:_.value,"onUpdate:visible":t[8]||(t[8]=e=>_.value=e),title:f.value?"编辑制品仓库":"添加制品仓库",width:"600px",onOk:Y,onCancel:P},{default:a(()=>[o(ae,{ref_key:"formRef",ref:V,model:l,rules:F,layout:"vertical"},{default:a(()=>[o(v,{field:"name",label:"仓库名称"},{default:a(()=>[o(h,{modelValue:l.name,"onUpdate:modelValue":t[3]||(t[3]=e=>l.name=e),placeholder:"请输入仓库名称"},null,8,["modelValue"])]),_:1}),o(v,{field:"type_id",label:"制品类型"},{default:a(()=>[o(D,{modelValue:l.type_id,"onUpdate:modelValue":t[4]||(t[4]=e=>l.type_id=e),placeholder:"请选择制品类型"},{default:a(()=>[(w(!0),M(R,null,O(C.value,e=>(w(),z(x,{key:e.id,value:e.id},{default:a(()=>[s(u(e.name)+" - "+u(e.description),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(v,{field:"url",label:"仓库地址"},{default:a(()=>[o(h,{modelValue:l.url,"onUpdate:modelValue":t[5]||(t[5]=e=>l.url=e),placeholder:"请输入仓库地址"},null,8,["modelValue"])]),_:1}),o(v,{field:"username",label:"用户名"},{default:a(()=>[o(h,{modelValue:l.username,"onUpdate:modelValue":t[6]||(t[6]=e=>l.username=e),placeholder:"请输入用户名（可选）"},null,8,["modelValue"])]),_:1}),o(v,{field:"password",label:"密码"},{default:a(()=>[o(ee,{modelValue:l.password,"onUpdate:modelValue":t[7]||(t[7]=e=>l.password=e),placeholder:"请输入密码（可选）"},null,8,["modelValue"])]),_:1}),o(te,{type:"info",class:"mt-4"},{icon:a(()=>[o(c(fe))]),default:a(()=>[t[16]||(t[16]=s(" 密码将被加密存储。不同类型的制品仓库可能需要不同的认证方式。 ",-1))]),_:1,__:[16]})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}});export{We as default};
